@use "../../abstracts/abstracts" as *;

// =============================================================================
// FACETED BROWSE - Modern Filter Sidebar
// =============================================================================

.faceted-browse-page,
.block-facetedBrowsePreview {

    // -------------------------------------------------------------------------
    // Layout Container
    // -------------------------------------------------------------------------
    #container {
        flex-wrap: wrap;

        @media (min-width: $xl) {
            flex-wrap: nowrap;
            gap: var(--space-12);
        }
    }

    // -------------------------------------------------------------------------
    // Sidebar
    // -------------------------------------------------------------------------
    #section-sidebar {
        width: 100%;
        overflow: hidden;

        @media (min-width: $xl) {
            border-inline-end: 1px solid var(--border);
            padding-inline-end: var(--space-6);
            width: 25%;
            z-index: auto !important;
            overflow: visible;
        }

        &.open {
            z-index: var(--z-modal) !important;
        }

        &-modal-toggle {
            margin-block-end: var(--space-6);
        }

        // Reset default field/fieldset styles in sidebar
        .field,
        fieldset {
            background: transparent;
            border: none;
            box-shadow: none;
            padding: 0;
            margin-block-end: 0;
        }

        button.close-button {
            background-color: var(--primary);
        }
    }

    // -------------------------------------------------------------------------
    // Facets Container
    // -------------------------------------------------------------------------
    #facets {
        display: flex;
        flex-direction: column;
        gap: var(--space-2);
        margin-block-end: var(--space-4);
        overflow: hidden;

        @media (min-width: $xl) {
            height: auto;
            margin-block-end: 0;
            overflow: initial;
        }

        &.show-all {
            height: auto;
            overflow: initial;
        }
    }

    #show-more-facets {
        margin-block-start: var(--space-3);

        @media (min-width: $xl) {
            display: none;
        }
    }

    // -------------------------------------------------------------------------
    // Category & Facet Containers (Accordion-style groups)
    // -------------------------------------------------------------------------
    .categories-container,
    .facets-container {
        border: none;
        padding: 0;
        margin: 0;
    }

    .category,
    .facet {
        background: var(--bg-surface);
        border: 1px solid var(--border);
        border-radius: var(--radius-md);
        margin-block-end: var(--space-3);
        overflow: hidden;
        transition:
            border-color var(--transition-fast),
            box-shadow var(--transition-fast);

        &:hover {
            border-color: color-mix(in srgb, var(--primary) 30%, var(--border-color) 70%);
        }

        &:last-child {
            margin-block-end: 0;
        }

        // Full-text search input styling
        &[data-facet-type="full_text"],
        &:has(.full-text) {
            padding-block-end: var(--space-3);

            input.full-text,
            input[type="text"]:not([type="hidden"]) {
                display: block;
                width: calc(100% - var(--space-8));
                margin: var(--space-3) var(--space-4);
                margin-block-end: 0;
                padding: var(--space-3);
                background: var(--bg-surface);
                border: 1px solid var(--border);
                border-radius: var(--radius-sm);
                font-family: inherit;
                font-size: var(--text-sm);
                color: var(--text-primary);
                transition:
                    border-color var(--transition-fast),
                    box-shadow var(--transition-fast);

                &:focus {
                    outline: none;
                    border-color: var(--primary);
                    box-shadow: 0 0 0 3px color-mix(in srgb, var(--primary) 20%, transparent 80%);
                }

                &::placeholder {
                    color: var(--text-muted);
                }
            }
        }

        // Ensure select dropdowns have proper spacing within facet container
        >select,
        select.value {
            margin: var(--space-3) var(--space-4);
            width: calc(100% - var(--space-8)) !important; // Account for left+right margins
            margin-block-end: 0;
        }

        // Add padding at bottom when facet contains a select
        &:has(select) {
            padding-block-end: var(--space-3);
        }
    }

    // -------------------------------------------------------------------------
    // Legends (Facet group headings)
    // -------------------------------------------------------------------------
    .categories-container legend,
    .facets-container legend {
        display: flex;
        align-items: center;
        width: 100%;
        padding: var(--space-3) var(--space-4);
        margin: 0;
        background: transparent; // Remove background for cleaner look
        border-block-end: 1px solid var(--border);
        color: var(--text-heading);
        font-family: $font__headings;
        font-weight: 600;
        font-size: var(--text-sm);
        letter-spacing: 0.02em;
        text-transform: uppercase;
        line-height: 1.4;
    }

    .categories-container legend {
        font-size: var(--text-base);
        text-transform: none;
    }

    // -------------------------------------------------------------------------
    // Select List (Options within each facet)
    // -------------------------------------------------------------------------
    .select-list {
        display: flex;
        flex-direction: column;
        gap: 0;
        margin: 0 !important;
        padding: var(--space-2);
        width: 100%;
        list-style: none;

        &-item {
            margin: 0;
            padding: 0;
            max-width: 100%;
            overflow: hidden;

            &::before {
                content: none !important;
            }
        }

        &-expand,
        &-collapse {
            display: inline-flex;
            align-items: center;
            gap: var(--space-2);
            margin: var(--space-2) var(--space-2) var(--space-1);
            padding: var(--space-2) var(--space-3);
            background: transparent;
            border: 1px dashed var(--border);
            border-radius: var(--radius-sm);
            color: var(--primary);
            font-size: var(--text-sm);
            font-weight: 500;
            cursor: pointer;
            transition:
                background var(--transition-fast),
                border-color var(--transition-fast);

            &:hover {
                background: var(--bg-muted);
                border-color: var(--primary);
            }
        }
    }

    // -------------------------------------------------------------------------
    // Labels & Custom Radio/Checkbox Styling
    // -------------------------------------------------------------------------
    .facet label,
    .category label,
    .select-list-item label {
        display: flex;
        align-items: flex-start;
        gap: var(--space-3);
        padding: var(--space-2) var(--space-3);
        margin: 0;
        border-radius: var(--radius-sm);
        cursor: pointer;
        transition: background var(--transition-fast);
        overflow: hidden;

        &:hover {
            background: var(--bg-muted);
        }

        // Custom radio button styling
        input[type="radio"],
        input[type="checkbox"] {
            // Hide default input but keep accessible
            -webkit-appearance: none;
            -moz-appearance: none;
            appearance: none;
            position: relative;
            flex-shrink: 0;
            width: 1.125rem;
            height: 1.125rem;
            margin: 0.125rem 0 0 0 !important;
            background: var(--bg-surface);
            border: 2px solid var(--border);
            cursor: pointer;
            transition:
                background var(--transition-fast),
                border-color var(--transition-fast),
                box-shadow var(--transition-fast);

            &:hover {
                border-color: var(--primary);
            }

            &:focus-visible {
                outline: 2px solid var(--primary);
                outline-offset: 2px;
            }

            &:checked {
                background: var(--primary);
                border-color: var(--primary);

                &::after {
                    opacity: 1;
                    transform: scale(1);
                }
            }

            &::after {
                content: "";
                position: absolute;
                opacity: 0;
                transform: scale(0.5);
                transition:
                    opacity var(--transition-fast),
                    transform var(--transition-fast);
            }
        }

        input[type="radio"] {
            border-radius: 50%;

            &::after {
                top: 50%;
                inset-inline-start: 50%;
                width: 0.375rem;
                height: 0.375rem;
                margin-top: -0.1875rem;
                margin-inline-start: -0.1875rem;
                background: var(--primary-contrast);
                border-radius: 50%;
            }
        }

        input[type="checkbox"] {
            border-radius: var(--radius-sm);

            &::after {
                top: 0.0625rem;
                inset-inline-start: 0.3125rem;
                width: 0.3125rem;
                height: 0.625rem;
                border: solid var(--primary-contrast);
                border-width: 0 2px 2px 0;
                transform: rotate(45deg) scale(0.5);
            }

            &:checked::after {
                transform: rotate(45deg) scale(1);
            }
        }

        // Label text styling
        span,
        >span:first-of-type {
            flex: 1;
            min-width: 0;
            overflow: hidden;
            text-overflow: ellipsis;
            font-size: var(--text-sm);
            line-height: 1.5;
            color: var(--text-primary);
        }
    }

    // Selected/active state for the whole label
    .select-list-item.active label,
    .facet label:has(input:checked) {
        background: color-mix(in srgb, var(--primary) 8%, transparent 92%);

        &:hover {
            background: color-mix(in srgb, var(--primary) 12%, transparent 88%);
        }
    }

    // -------------------------------------------------------------------------
    // Categories List
    // -------------------------------------------------------------------------
    #categories {
        list-style: none;
        margin: 0;
        padding: var(--space-2);

        li {
            border-block-end: none;
            margin: 0;
            padding: 0;

            &::before {
                content: none !important;
            }

            a {
                display: flex;
                align-items: center;
                gap: var(--space-3);
                padding: var(--space-2) var(--space-3);
                border-radius: var(--radius-sm);
                color: var(--text-primary);
                font-size: var(--text-sm);
                text-decoration: none;
                transition:
                    background var(--transition-fast),
                    color var(--transition-fast);

                &:hover {
                    background: var(--bg-muted);
                    color: var(--primary);
                }

                &::before {
                    content: "";
                    flex-shrink: 0;
                    width: 0.5rem;
                    height: 0.5rem;
                    background: var(--primary);
                    border-radius: 50%;
                    opacity: 0.6;
                }
            }
        }
    }

    #categories-return {
        display: inline-flex;
        align-items: center;
        gap: var(--space-2);
        margin-block-end: var(--space-3);
        padding: var(--space-2) var(--space-3);
        background: var(--bg-muted);
        border-radius: var(--radius-sm);
        color: var(--primary);
        font-size: var(--text-sm);
        font-weight: 500;
        text-decoration: none;
        transition:
            background var(--transition-fast),
            color var(--transition-fast);

        &:hover {
            background: color-mix(in srgb, var(--primary) 15%, var(--bg-muted) 85%);
            color: var(--primary-hover);
        }

        &::before {
            @include font-awesome;
            content: "\f053";
            display: inline-block;
            font-size: 0.7rem;
            text-decoration: none;
        }
    }

    // -------------------------------------------------------------------------
    // Main Content Area
    // -------------------------------------------------------------------------
    #section-content {
        width: 100%;

        @media (min-width: $xl) {
            width: 75%;
        }

        .browse-controls {
            border-block-end: none;
            margin-block-end: 0;

            .pagination {
                margin-block-start: 0;
            }
        }
    }

    // -------------------------------------------------------------------------
    // Results Display
    // -------------------------------------------------------------------------
    .faceted-results,
    .resource-list {
        img {
            max-height: 3rem;
            max-width: 3rem;
            border-radius: var(--radius-sm);
        }
    }

    .faceted-results {
        img {
            margin-inline-end: var(--space-2);
        }
    }

    .resource-name {
        font-weight: 500;
    }

    .resource-list {
        padding-block-start: 5px;

        .resource {
            flex-wrap: wrap;
            padding: var(--space-3) !important;
        }

        .resource-link {
            width: 100%;
        }
    }

    // -------------------------------------------------------------------------
    // Table Layout
    // -------------------------------------------------------------------------
    .faceted-browse-table-wrapper {
        overflow-x: auto;
        padding: 0 var(--space-1);
        -webkit-overflow-scrolling: touch;
    }

    table.faceted-results {
        width: 100%;
        border-collapse: separate;
        border-spacing: 0 var(--space-3);
        table-layout: fixed; // Key for consistent column widths

        // Flexible column widths - works for various configurations
        // First column (usually main content like Title) is wider
        // Last column (usually Date) is narrower and doesn't wrap
        colgroup col,
        thead th,
        tbody td {
            &:first-child {
                width: 40%;
            }

            // Middle columns get equal share of remaining space
            &:not(:first-child):not(:last-child) {
                width: auto;
            }

            // Last column is narrower (typically Date)
            &:last-child {
                width: 15%;
                min-width: 6rem;
            }
        }

        thead {
            background-color: var(--bg-muted);
            color: var(--text-primary);

            th {
                padding: var(--space-3);
                font-weight: 600;
                text-align: start;
                white-space: nowrap;
                overflow: hidden;
                text-overflow: ellipsis;
            }
        }

        tbody {
            tr {
                background-color: var(--bg-surface);
                box-shadow: var(--shadow-sm);
                transition: box-shadow var(--transition-fast);

                &:hover {
                    box-shadow: var(--shadow-md);
                }

                td {
                    padding: var(--space-3);
                    vertical-align: middle;
                    overflow: hidden;

                    // Date column - prevent breaking
                    &:last-child {
                        white-space: nowrap;
                        text-overflow: ellipsis;
                    }

                    // Middle columns (summaries, descriptions) - limit lines
                    &:not(:first-child):not(:last-child) {
                        // Allow wrapping but limit to 3 lines max
                        display: -webkit-box;
                        -webkit-line-clamp: 3;
                        -webkit-box-orient: vertical;
                        overflow: hidden;
                        white-space: normal;
                        line-height: 1.5;
                    }

                    // Resource links - constrained display
                    .resource-link {
                        display: inline-flex;
                        align-items: center;
                        gap: var(--space-2);
                        max-width: 100%;
                        text-decoration: none;
                        color: var(--link-color);
                        transition: color var(--transition-fast);

                        &:hover {
                            color: var(--link-hover);
                        }

                        img {
                            flex-shrink: 0;
                            width: 2.5rem;
                            height: 2.5rem;
                            max-width: 2.5rem;
                            max-height: 2.5rem;
                            object-fit: cover;
                            border-radius: var(--radius-sm);
                        }

                        .resource-name {
                            overflow: hidden;
                            text-overflow: ellipsis;
                            white-space: nowrap;
                            min-width: 0;
                        }
                    }

                    // When multiple authors, stack them
                    >.resource-link+br+.resource-link,
                    >br+.resource-link {
                        margin-block-start: var(--space-1);
                    }
                }
            }
        }

        // Mobile: Adjust column widths for small screens
        @media (max-width: $md) {

            thead th,
            tbody td {
                &:first-child {
                    width: 45%;
                }

                &:last-child {
                    width: 20%;
                    min-width: 5rem;
                }
            }
        }
    }

    // -------------------------------------------------------------------------
    // Tablesaw Overrides (Responsive Tables)
    // Show all columns on desktop, use swipe navigation on mobile
    // -------------------------------------------------------------------------
    .tablesaw {

        // On desktop, show all columns
        @media (min-width: $lg) {

            th.tablesaw-swipe-cellhidden,
            td.tablesaw-swipe-cellhidden {
                display: table-cell !important;
            }
        }

        // Navigation buttons for mobile swipe
        &-advance {
            display: flex;
            gap: var(--space-2);
            margin-block-start: var(--space-3);

            @media (min-width: $lg) {
                display: none; // Hide navigation on desktop
            }

            .tablesaw-nav-btn {
                padding: var(--space-2) var(--space-3);
                font-size: var(--text-sm);
                background: var(--bg-surface);
                border: 1px solid var(--border-color);
                border-radius: var(--radius-sm);
                color: var(--text-primary);
                cursor: pointer;
                transition:
                    background var(--transition-fast),
                    border-color var(--transition-fast);

                &:hover:not(.disabled) {
                    background: var(--bg-muted);
                    border-color: var(--primary);
                    color: var(--primary);
                }

                &.disabled {
                    opacity: 0.5;
                    cursor: not-allowed;
                }
            }
        }
    }
}